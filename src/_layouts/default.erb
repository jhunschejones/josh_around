<!doctype html>
<html lang="en" class="min-h-full fonts-loading">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title><%= (resource&.data&.title || "Josh Around") %></title>

    <%# preventing font flash by delaying page load if font's haven't loaded yet %>
    <%# but only the first page load, using sessionStorage after that (part 1) %>
    <script>
      try {
        if (!sessionStorage.getItem("fontsLoaded")) {
          document.documentElement.classList.add("fonts-loading");
        }
      } catch(e) {}
    </script>
    <style>
      html.fonts-loading body {
        opacity: 0;
        transition: opacity 0.3s ease;
      }
      html:not(.fonts-loading) body {
        opacity: 1;
      }
    </style>

    <%# Bridgetown: link to the compiled CSS & JS bundles %>
    <link rel="stylesheet" href="<%= asset_path :css %>">
    <script src="<%= asset_path :js %>" defer></script>

    <%# Let browsers use their preferred color scheme %>
    <meta name="color-scheme" content="light dark">

    <%# for bridgetown-feed's atom feed %>
    <%= feed_meta %>
  </head>

  <body class="min-h-screen bg-white text-slate-950 dark:bg-zinc-950 dark:text-zinc-100">
    <%# Site Title %>
    <div class="mx-auto max-w-3xl px-6 md:px-3 pt-8 pb-4">
      <a href="<%= site.base_path || "/" %>"
         class="text-2xl font-bold tracking-tight j-text-cyan">
        Josh Around
      </a>
    </div>

    <%# Main Content %>
    <main class="mx-auto max-w-3xl px-6 md:px-3 py-6">
      <%= yield %>
    </main>

    <%# Footer: don't show on the "post" page because the date here could be confused with the publish date %>
    <% unless data.layout == "post" %>
      <footer class="mx-auto max-w-3xl px-6 md:px-3 py-6 border-t border-dotted border-zinc-300 dark:border-zinc-700 text-xs j-text-gray">
        <div>© <%= Time.now.year %> Josh Around · Last updated <%= local_time(format: "%B %e, %Y %H:%M %Z") %></div>
      </footer>
    <% end %>

    <%# preventing font flash by delaying page load if font's haven't loaded yet %>
    <%# but only the first page load, using sessionStorage after that (part 2) %>
    <script>
      if (document.fonts) {
        document.fonts.ready.then(() => {
          document.documentElement.classList.remove("fonts-loading");
          try {
            sessionStorage.setItem("fontsLoaded", "true");
          } catch(e) {}
        });

        // Safety timeout (fallback if something fails)
        setTimeout(() => {
          document.documentElement.classList.remove("fonts-loading");
        }, 1200);
      }
    </script>
  </body>
</html>
